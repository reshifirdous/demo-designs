{% macro device_type(model, slug, manufacturer_slug, u_height) -%}
  - "!create_or_update:model": "{{ model }}"
    slug: "{{ slug }}"
    manufacturer__slug: "{{ manufacturer_slug }}"
    u_height: {{ u_height }}
{%- endmacro %}

{% macro device(name, device_type_slug, device_role_slug, site_slug, status_name, interfaces) -%}
  - "!create_or_update:name": "{{ name }}"
    device_type__slug: "{{ device_type_slug }}"
    device_role__slug: "{{ device_role_slug }}"
    site__slug: "{{ site_slug }}"
    status__name: "{{ status_name }}"
    interfaces: {{ interfaces }}
{%- endmacro %}

{% macro interface(name, status, type, primary_ip4, address, status_name, description) -%}
  - "!create_or_update:name": "{{ name }}"
    status__name: "{{ status }}"
    type: "{{ type }}"
    primary_ip4: {{ primary_ip4 }}
    {% if address %}
    ip_addresses:
    - "!create_or_update:address": "{{ address }}"
      status__name: "{{ status_name }}"
      description: "{{ description }}"
    {% endif %}
{%- endmacro %}

{% macro vlan(vid, name, status_name, site_name, description) -%}
  - vid: {{ vid }}
    name: "{{ name }}"
    status__name: "{{ status_name }}"
    site__name: "{{ site_name }}"
    description: "{{ description }}"
{%- endmacro %}

{% macro prefix(prefix, site_name, status_name, description, tenant_name) -%}
  - prefix: "{{ prefix }}"
    site__name: "{{ site_name }}"
    status__name: "{{ status_name }}"
    description: "{{ description }}"
    tenant__name: "{{ tenant_name }}"
{%- endmacro %}


device_types:
  {{ device_type("8200", "8200", "cisco", 1) }}

devices:
  {{ device(site_name + "-wrx-a", "8200", "wanswitch", site_name, "Active", [
    interface("loopback1", "Planned", "virtual", true, get_management_interface_ip(site_name + '-wrx-a', 'loopback1'), "Reserved", "loopback1"),
    interface("loopback2", "Planned", "virtual", false, get_site_interface_ip(site_name + '-wrx-a', 'loopback2'), "Reserved", "loopback2"),
    interface("vlan1651", "Planned", "virtual", false, get_management_interface_ip(site_name + '-wrx-a', 'vlan1651'), "Reserved", "vlan1651"),
    interface("vlan1711", "Planned", "virtual", false, get_management_interface_ip(site_name + '-wrx-a', 'vlan1711'), "Reserved", "vlan1711")
  ]) }}